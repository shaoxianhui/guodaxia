<extend name="base2" />
<block name="css">
<link rel="stylesheet" href="__PUBLIC__/Common/dataTables/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="__PUBLIC__/Common/dataTables/extensions/tableTools/css/dataTables.tableTools.min.css">
<link rel="stylesheet" href="__PUBLIC__/Common/dataTables/extensions/editor/css/dataTables.editor.min.css">
<link rel="stylesheet" href="__PUBLIC__/Common/dataTables/css/dataTables.bootstrap.css">
<link rel="stylesheet" href="__PUBLIC__/Common/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
</block>
<block name="content">
<div class="content">
    <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading">订单管理</div>
        <div class="panel-body">
            订单日期　:　<input type="text" id="datetimepicker" readonly>
        </div>
        <div style="margin:0px 15px 0px 15px">
        <table id="table" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>客户名称</th>
                    <th>最早送货时间</th>
                    <th>最晚送货时间</th>
                    <th>状态</th>
                    <th>备注</th>
                </tr>
            </thead>
        </table>
        </div>
    </div>
</div>
</block>
<block name='script'>
<script src="__PUBLIC__/Common/dataTables/js/jquery.dataTables.js"></script>
<script src="__PUBLIC__/Common/dataTables/extensions/tableTools/js/dataTables.tableTools.min.js"></script>
<script src="__PUBLIC__/Common/dataTables/extensions/editor/js/dataTables.editor.min.js"></script>
<script src="__PUBLIC__/Common/dataTables/js/dataTables.bootstrap.js"></script>
<script src="__PUBLIC__/Common/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript">
var editor;
$(document).ready(function() {
$('#order_edit').addClass('active');
editor = new $.fn.dataTable.Editor( {
        ajax: "order_crud",
        table: "#table",
        fields: [
                    {
                        label: "客户名称",
                        name: "customer"
                    },
                    {
                        label: "送货日期",
                        name: "cdate",
                        type: "date",
                        def: "{$date}",
                        dateFormat: 'y-M-d'
                    },
                    {
                        label: "最早送货时间",
                        name: "earliest"
                    },
                    {
                        label: "最晚送货时间",
                        name: "latest"
                    },
                    {
                        label: "备注",
                        name: "comment"
                    }
                ]
    } );
$.fn.dataTable.TableTools.defaults.sSwfPath='__PUBLIC__/Common/dataTables/extensions/tableTools/swf/copy_csv_xls_pdf.swf';
$('#table').dataTable({
    dom: "Tfrtip",
    searching: true,
    lengthChange: false,
    processing: true,
    serverSide: true,
    order: [[ 0, "desc" ]],
    ajax: "{:U('Admin/Order/index', array(), '')}/date/{$date}",
    columns: [
                { "data": "customer" , "orderable": true },
                { "data": "earliest" , "orderable": false },
                { "data": "latest" , "orderable": false },
                { "data": "status" , "orderable": false, "render": 
                    function (data, type, row) {
                    return row.status == 0 ? '未处理' : '已处理'; }
                },
                { "data": "comment" , "orderable": false
                }
            ],
    tableTools: {
        sRowSelect: "single",
        aButtons: [
            { sExtends: "editor_create", editor: editor },
            { sExtends: "editor_edit",   editor: editor },
            { sExtends: "editor_remove", editor: editor },
            "copy",
            {
                "sExtends":    "collection",
                "sButtonText": "Save",
                "aButtons":    [ "csv", "xls", "pdf" ]
            },
            "print"
        ]
        }
        });
    Date.prototype.Format = function(fmt) 
    {
      var o = { 
        "M+" : this.getMonth()+1,                 //月份 
        "d+" : this.getDate(),                    //日 
        "h+" : this.getHours(),                   //小时 
        "m+" : this.getMinutes(),                 //分 
        "s+" : this.getSeconds(),                 //秒 
        "q+" : Math.floor((this.getMonth()+3)/3), //季度 
        "S"  : this.getMilliseconds()             //毫秒 
      }; 
      if(/(y+)/.test(fmt)) 
        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length)); 
      for(var k in o) 
        if(new RegExp("("+ k +")").test(fmt)) 
      fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length))); 
      return fmt; 
    }
    $('#datetimepicker').attr('value', '{$date}');
    $('#datetimepicker').datetimepicker({
        format: 'yyyy-mm-dd',
        minView: 2,
        autoclose: true
        }).on('changeDate', function(ev){
            window.location.href="{:U('Admin/Index/order_edit','','')}/date/" + ev.date.Format('yyyy-MM-dd');
        });
});
</script>
</block>

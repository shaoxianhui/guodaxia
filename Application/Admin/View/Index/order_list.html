<extend name="base2" />
<block name="css">
<link rel="stylesheet" href="__PUBLIC__/Common/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
</block>
<block name="content">
<div class="content">
    <div class="row">
        <div class="panel panel-default">
            <!-- Default panel contents -->
            <div class="panel-heading">订单详情</div>
            <div class="panel-body">
                订单日期　:　<input type="text" id="datetimepicker" readonly>
            </div>
            <div style="margin:0px 15px 0px 15px">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>订单ID</th>
                            <th>客户名称</th>
                            <th>最早送货时间</th>
                            <th>最晚送货时间</th>
                            <th>状态</th>
                            <th>备注</th>
                            <th>订单项ID</th>
                            <th>产品</th>
                            <th>数量</th>
                            <th>单价</th>
                            <th>详细</th>
                        </tr>
                    </thead>
                    <tbody>
                    <volist name="order" id="o">
                    <tr>
                        <td rowspan="{$o.orderItems|count}">{$o.id}</td>
                        <td rowspan="{$o.orderItems|count}">{$o.customer}</td>
                        <td rowspan="{$o.orderItems|count}">{$o.earliest}</td>
                        <td rowspan="{$o.orderItems|count}">{$o.latest}</td>
                        <td rowspan="{$o.orderItems|count}">{$o.status}</td>
                        <td rowspan="{$o.orderItems|count}">{$o.comment}</td>
                        <volist name="o.orderItems" offset="0" length="1" id="i1">
                        <td>{$i1.id}</td>
                        <td>{$i1.product}</td>
                        <td>{$i1.quantity}</td>
                        <td>{$i1.money}</td>
                        <td>{$i1.comment}</td>
                        </volist>
                    </tr>
                    <volist name="o.orderItems" offset="1" id="i2">
                    <tr>
                        <td>{$i2.id}</td>
                        <td>{$i2.product}</td>
                        <td>{$i2.quantity}</td>
                        <td>{$i2.money}</td>
                        <td>{$i2.comment}</td>
                    </tr>
                    </volist>
                    </volist>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</block>
<block name='script'>
<script src="__PUBLIC__/Common/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
$('#order_list').addClass('active');
Date.prototype.Format = function(fmt) 
{
  var o = { 
    "M+" : this.getMonth()+1,                 //月份 
    "d+" : this.getDate(),                    //日 
    "h+" : this.getHours(),                   //小时 
    "m+" : this.getMinutes(),                 //分 
    "s+" : this.getSeconds(),                 //秒 
    "q+" : Math.floor((this.getMonth()+3)/3), //季度 
    "S"  : this.getMilliseconds()             //毫秒 
  }; 
  if(/(y+)/.test(fmt)) 
    fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length)); 
  for(var k in o) 
    if(new RegExp("("+ k +")").test(fmt)) 
  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length))); 
  return fmt; 
}
$('#datetimepicker').attr('value', '{$date}');
$('#datetimepicker').datetimepicker({
    format: 'yyyy-mm-dd',
    minView: 2,
    autoclose: true
    }).on('changeDate', function(ev){
        window.location.href="{:U('Admin/Index/order_list','','')}/date/" + ev.date.Format('yyyy-MM-dd');
    });
});
</script>
</block>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0" />
    <!--<meta name="viewport" content="width=320,maximum-scale=1.3,user-scalable=no">-->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>果大侠</title>
    <link rel="stylesheet" href="__PUBLIC__/Wechat/css/normalize.css" type="text/css" media="screen">
    <link rel="stylesheet" href="__PUBLIC__/Wechat/css/main.css" type="text/css" media="screen">
    <!-- fruit Scheme -->
    <link rel="stylesheet" href="__PUBLIC__/Wechat/css/fruit.css" type="text/css" media="screen">
</head>
<body>
    <div id="st-container">
        <div class="st-pusher">
            <div class="st-content">
                <div class="st-content-inner overflow_no">
                    <!-- Top Navigation -->
                    <header>
                    <div>
                        <a class="menu-left" href="{:U('Wechat/Cart/index')}"></a></div>
	                    <h1>提交订单</h1><a href="#"></a>
                    </header>
                    <div class="">
                        <div class="swiper-container swiper-nested">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">
                                    <div class="pages_container order_bg">
                                        <div class="menu_order">
                                            <div class="order_div8">
                                                填写并核对订单信息
                                            </div>
                                            <ul>
                                            <volist name="ps" id="weekps">
                                                <li>
                                                    <table class="tb1" data-test="ds">
                                                        <tr>
                                                            <td class="tb1-td1">
                                                                <div class="order-time">
                                                                    {$weekname[$key]}<br />
                                                                    {$weekps.day}</div>
                                                            </td>
                                                            <td class="tb1-td2">
                                                                <table class="sss" data-test="sd">
                                                                    <volist name="weekps.ps" id="ps">
                                                                    <tr class="tr1" id="ps{$ps.id}" data-test="dsdsdsd">
                                                                        <td class="td1 td_bottom">
                                                                            <img src="__PUBLIC__/Wechat/images/{$ps.picUrl}" alt="" title="" />
                                                                        </td>
                                                                        <td class="td2 td_bottom td_padding">
                                                                            <span>{$ps.name}</span><br/><tt>￥{$ps.price} </tt>
                                                                            <div>
                                                                                <input name="" type="button" value="-" class="min btn_box" data-id="{$ps.id}"/>
                                                                                <input id="text_box" name="" type="text" value="{$ps.count}" class="text_box" />
                                                                                <input name="" type="button" value="+" class="add btn_box" data-id="{$ps.id}"/>
                                                                            </div>
                                                                        </td>
                                                                        <td  data-test="aaa" class="td3 td_bottom" valign="top">
                                                                            <a
                                                                            data-id="{$ps.id}" href="javascript:void()" class="del"><span class="order_btn_del"></span></a> 
                                                                        </td>
                                                                    </tr>
                                                                    </volist>
                                                                </table>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </li>
                                            </volist>
                                            </ul>
                                            <br />
                                            <div class="order_div8">
                                                确认收货地址
                                            </div>
                                            <div class="address-box">
                                                <div id="edit_address">
                                                    <form id="loginform" name="loginform">
                                                    <dl>
                                                        <dt>收货地址</dt>
                                                        <dd>
                                                            <input id="txtUserName" name="txtUserName" class="input txt" placeholder="请选择公司所在大厦"
                                                                type="text" maxlength="50" /></dd>
                                                    </dl>
                                                    <dl>
                                                        <dt>详细地址</dt>
                                                        <dd>
                                                            <input id="txtPassword" name="txtPassword" placeholder="楼层及公司名称" class="input txt"
                                                                type="text" maxlength="50" /></dd>
                                                    </dl>
                                                    <dl>
                                                        <dt>收货人</dt>
                                                        <dd>
                                                            <input id="Text1" name="txtPassword" class="input txt" placeholder="长度不超过25个字符" type="text"
                                                                maxlength="50" /></dd>
                                                    </dl>
                                                    <dl>
                                                        <dt>联系方式</dt>
                                                        <dd>
                                                            <input id="Text2" name="txtPassword" class="input txt" placeholder="请填写联系方式" type="text"
                                                                maxlength="50" /></dd>
                                                    </dl>
                                                    <div class="order_btn_dl">
                                                        <a href="javascript:void()" class="button10 green1 radius6" onclick="save_address()">
                                                            确认收货地址</a>
                                                    </div>
                                                    </form>
                                                    <div id="msgtips">
                                                    </div>
                                                </div>
                                                <div id="address" style="display: none">
                                                    <div class="order_s_address">
                                                        <span>张山</span> <span style="float: right">13858895642</span><br />
                                                    </div>
                                                    <div class="order_s_address1">
                                                        <span>搜狐网络大厦12楼</span>
                                                    </div>
                                                    <div class="order_btn_dl">
                                                        <a href="javascript:void()" class="button10 green1 radius6" onclick="edit_address()">
                                                            编辑地址</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="order_b_btn">
                                                <div class="order_s_price">
                                                    商品总额：<span class="color1">￥110.00</span><br />
                                                    应付金额：<span class="color2" id="total">￥{$money}</span></div>
                                                <a href="javascript:void(0);" onclick="callpay()" class="button10 green2 radius6">提交订单</a>
                                            </div>
                                            <div class="clearfix">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /st-content-inner -->
            </div>
            <!-- /st-content -->
        </div>
        <!-- /st-pusher -->
    </div>
    <script src="__PUBLIC__/Wechat/js/jquery-1.10.2.min.js"></script>
    <!-- Swiper -->
    <script src="__PUBLIC__/Wechat/js/idangerous.swiper-2.2.min.js"></script>
    <script src="__PUBLIC__/Wechat/js/classie.js"></script>
    <script src="__PUBLIC__/Wechat/js/sidebarEffects.js"></script>
    <script src="__PUBLIC__/Wechat/js/swipers.js"></script>
    <script src="__PUBLIC__/Wechat/js/custom.js"></script>
    <script src="__PUBLIC__/Wechat/js/code.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            //数量增加操作
            $(".add").click(function () {
                var t = $(this).prev();
                
                $.post("{:U('Wechat/Cart/add')}", {
                        openId : "{$openId}",
                        product_id : $(this).attr('data-id')
                        }, function(result) {
                        if(result.state_code == 0){
                t.val(parseInt(t.val()) + 1)
                if (parseInt(t.val()) != 1) {
                    t.prev().attr('disabled', false);
                }
                            $("#total").html(result.total_price); //toFixed()是保留小数点的函数很实用哦
                        } else {
                        }
                });
            })
            //数量减少操作
            $(".min").click(function () {
                //获得文本框对象
                var t = $(this).next();
                $.post("{:U('Wechat/Cart/dec')}", {
                        openId : "{$openId}",
                        product_id : $(this).attr('data-id')
                        }, function(result) {
                        if(result.state_code == 0){
                t.val(parseInt(t.val()) - 1);
                if (parseInt(t.val()) == 1) {
                    t.prev().attr('disabled', true);
                }
                            $("#total").html(result.total_price); //toFixed()是保留小数点的函数很实用哦
                        } else {
                        }
                });
            })
            $(".del").click(function () {
                    var t = $(this);
                $.post("{:U('Wechat/Cart/del')}", {
                        openId : "{$openId}",
                        product_id : $(this).attr('data-id')
                        }, function(result) {
                        if(result.state_code == 0){
                    var bb = t.parent().parent().siblings().length;
                    if(bb == 0) {
                        t.parentsUntil('.tb1').remove();

                    } else {
                        var id=t.attr('data-id');
                        $('#ps'+id).remove();
                    }
                            $("#total").html(result.total_price); //toFixed()是保留小数点的函数很实用哦
                        } else {
                        }
                });
                    })
        });

        function edit_address() {
            $("#edit_address").css("display", "block");
            $("#address").css("display", "none");
        }
        function del(id) {
            //$('#ps'+id).remove();
        }
        function save_address() {
            $("#address").css("display", "block");
            $("#edit_address").css("display", "none");
        }
		function callpay()
		{
			if (typeof WeixinJSBridge == "undefined"){
			    if( document.addEventListener ){
			        document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
			    }else if (document.attachEvent){
			        document.attachEvent('WeixinJSBridgeReady', jsApiCall); 
			        document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
			    }
			}else{
                $.post("{:U('Wechat/Cart/createOrder')}", {
                        openId : "{$openId}"
                        }, function(result) {
                        if(result.success == true){
                        WeixinJSBridge.invoke(
                            'getBrandWCPayRequest',
                            result.jsApiParameters,
                            function(res){
                            if(res.err_msg == 'get_brand_wcpay_request:ok') {
                                window.location.href =
                                "http://www.meirixianguo.com/wechat/wxpay/successpay/openId/{$openId}";
                            }
                            }
                        );
                        } else {
                        }
                });
                }
		}
    </script>
</body>
</html>

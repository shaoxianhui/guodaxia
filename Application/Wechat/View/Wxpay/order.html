<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>果大侠</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="__PUBLIC__/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Bootstrap theme -->
    <link rel="stylesheet" href="__PUBLIC__/bower_components/bootstrap/dist/css/bootstrap-theme.min.css">

  </head>

  <body role="document">
    <div class="container-fluid theme-showcase" role="main">
		<div class="row text-center">
			<div class="panel panel-success">
				<div class="panel-heading">本周水果安排</div>
				<div class="panel-body">
                    周一：苹果</br>
                    周二：橘子</br>
                    周三：香蕉</br>
                    周四：葡萄</br>
                    周五：神秘水果</br>
				</div>
			</div>
			<div class="panel panel-success">
				<div class="panel-heading">选择取货地点</div>
				<div class="panel-body">
				   <select id="location" class="form-control">
                       <volist name="locations" id="location">
                           <option value="{$location.id}">{$location.name}</option>
                       </volist>
					</select>
				</div>
			</div>
			<div class="panel panel-success">
				<div class="panel-heading">个人信息</div>
				<div class="panel-body">
					<input id="name" type="text" class="form-control" style="margin:0px 0px 10px 0px" value="{$name|default=""}" placeholder="姓名">
                    <input id="phone" type="text" class="form-control" value="{$phone|default=""}" placeholder="手机号">
				</div>
			</div>
			<div class="panel panel-success">
				<div class="panel-heading">订单金额</div>
				<div class="panel-body">
                    {$money}元
				</div>
			</div>
			<button type="button" class="btn btn-success btn-lg btn-block"
                onclick="callpay()">付款</button>
		</div>
    </div>
    <script src="__PUBLIC__/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="__PUBLIC__/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<script type="text/javascript">
		//调用微信JS api 支付
		function jsApiCall()
		{
            if($('#name').val() == '' || $('#phone').val() == '') {
                alert('请填写姓名和电话');
                return;
            }
            $.post("{:U('Wechat/Wxpay/createOrder')}", {
                    openId : "{$openId}",
                    trade : "{$trade}",
                    locationId : $('#location').val(),
                    name : $('#name').val(),
                    phone : $('#phone').val()
                    }, function(result) {
                    if(result.success == true) {
                        WeixinJSBridge.invoke(
                            'getBrandWCPayRequest',
                            {$jsApiParameters},
                            function(res){
                            if(res.err_msg == 'get_brand_wcpay_request:ok') {
                                window.location.href = "http://www.meirixianguo.com/wechat/wxpay/success";
                            }
                            //alert(res.err_code + res.err_desc+res.err_msg);
                            }
                        );
                    } else {
                        alert('false');
                    }
            });
		}

		function callpay()
		{
			if (typeof WeixinJSBridge == "undefined"){
			    if( document.addEventListener ){
			        document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
			    }else if (document.attachEvent){
			        document.attachEvent('WeixinJSBridgeReady', jsApiCall); 
			        document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
			    }
			}else{
			    jsApiCall();
			}
		}
        $(document).ready(function() {
            $('#location').val('{$locationId}');
        });
	</script>
  </body>
</html>
